"use strict";(self["webpackChunkvue_shop"]=self["webpackChunkvue_shop"]||[]).push([[580],{6478:function(e,t,s){s.r(t),s.d(t,{default:function(){return n}});var o=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{separator:">"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("商品管理")]),t("el-breadcrumb-item",[e._v("添加商品")])],1),t("el-card",{staticClass:"box-card"},[t("el-alert",{attrs:{title:"添加商品信息",center:"","show-icon":"",type:"info"}}),t("el-steps",{attrs:{active:+e.active,"finish-status":"success","align-center":""}},[t("el-step",{attrs:{title:"基本信息"}}),t("el-step",{attrs:{title:"商品参数"}}),t("el-step",{attrs:{title:"商品属性"}}),t("el-step",{attrs:{title:"商品图片"}}),t("el-step",{attrs:{title:"商品内容"}}),t("el-step",{attrs:{title:"完成"}})],1),t("el-form",{ref:"addGoodsRef",staticClass:"demo-ruleForm",attrs:{model:e.addGoodsForm,rules:e.addGoodsRules,"label-width":"100px","label-position":"top"}},[t("el-tabs",{attrs:{"tab-position":"left","before-leave":e.beforeTabLeave},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[t("el-tab-pane",{attrs:{label:"基本信息",name:"0"}},[t("el-form-item",{attrs:{label:"商品名称",prop:"goods_name"}},[t("el-input",{model:{value:e.addGoodsForm.goods_name,callback:function(t){e.$set(e.addGoodsForm,"goods_name",t)},expression:"addGoodsForm.goods_name"}})],1),t("el-form-item",{attrs:{label:"商品价格",prop:"goods_price"}},[t("el-input",{model:{value:e.addGoodsForm.goods_price,callback:function(t){e.$set(e.addGoodsForm,"goods_price",t)},expression:"addGoodsForm.goods_price"}})],1),t("el-form-item",{attrs:{label:"商品重量",prop:"goods_weight"}},[t("el-input",{model:{value:e.addGoodsForm.goods_weight,callback:function(t){e.$set(e.addGoodsForm,"goods_weight",t)},expression:"addGoodsForm.goods_weight"}})],1),t("el-form-item",{attrs:{label:"商品数量",prop:"goods_number"}},[t("el-input",{model:{value:e.addGoodsForm.goods_number,callback:function(t){e.$set(e.addGoodsForm,"goods_number",t)},expression:"addGoodsForm.goods_number"}})],1),t("el-form-item",{attrs:{label:"商品分类",prop:"goods_cat"}},[t("el-cascader",{attrs:{options:e.cateList,props:e.goodProps,clearable:""},model:{value:e.addGoodsForm.goods_cat,callback:function(t){e.$set(e.addGoodsForm,"goods_cat",t)},expression:"addGoodsForm.goods_cat"}})],1)],1),t("el-tab-pane",{attrs:{label:"商品参数",name:"1"}},e._l(e.manyTabletList,(function(s){return t("el-form-item",{key:s.attr_id,attrs:{label:s.attr_name}},[t("el-checkbox-group",{model:{value:s.attr_vals,callback:function(t){e.$set(s,"attr_vals",t)},expression:"item.attr_vals"}},e._l(s.attr_vals,(function(e,s){return t("el-checkbox",{key:s,attrs:{label:e,border:"",size:"small"}})})),1)],1)})),1),t("el-tab-pane",{attrs:{label:"商品属性",name:"2"}},e._l(e.onlyTabletList,(function(s){return t("el-form-item",{key:s.attr_id,attrs:{label:s.attr_name}},[t("el-input",{model:{value:s.attr_name,callback:function(t){e.$set(s,"attr_name",t)},expression:"item.attr_name"}})],1)})),1),t("el-tab-pane",{attrs:{label:"商品图片",name:"3"}},[t("el-upload",{staticClass:"upload-demo",attrs:{action:e.uploadURL,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"list-type":"picture",headers:e.headerObj,"on-success":e.handleSuccess}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])],1)],1),t("el-tab-pane",{attrs:{label:"商品内容",name:"4"}},[t("quill-editor",{model:{value:e.addGoodsForm.goods_introduce,callback:function(t){e.$set(e.addGoodsForm,"goods_introduce",t)},expression:"addGoodsForm.goods_introduce"}}),t("el-button",{staticClass:"btnAdd",attrs:{type:"primary"},on:{click:e.addGoods}},[e._v("添加商品")])],1)],1)],1)],1),t("el-dialog",{attrs:{title:"图片预览",visible:e.previewDialogVisible,width:"30%"},on:{"update:visible":function(t){e.previewDialogVisible=t}}},[t("span",[t("img",{staticStyle:{width:"100%"},attrs:{src:e.previewURL,alt:""}})]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.previewDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.previewDialogVisible=!1}}},[e._v("确 定")])],1)])],1)},a=[],r=(s(7658),{data(){return{active:0,addGoodsForm:{goods_name:"",goods_price:"",goods_weight:"",goods_number:"",goods_cat:"",pics:[],goods_introduce:"",attrs:[]},addGoodsRules:{goods_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],goods_price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],goods_weight:[{required:!0,message:"请输入商品重量",trigger:"blur"}],goods_number:[{required:!0,message:"请输入商品数量",trigger:"blur"}],goods_cat:[{required:!0,message:"请选择商品分类",trigger:"blur"}]},cateList:[],goodProps:{children:"children",label:"cat_name",value:"cat_id"},manyTabletList:[],onlyTabletList:[],uploadURL:"http://127.0.0.1:8888/api/private/v1/upload",headerObj:{Authorization:window.sessionStorage.getItem("token")},previewURL:"",previewDialogVisible:!1}},methods:{async initCateList(){const{data:e}=await this.$http.get("categories");if(200!==e.meta.status)return this.$message.error("获取商品分类失败");this.cateList=e.data},beforeTabLeave(e,t){return"0"===e||3===this.addGoodsForm.goods_cat.length?("1"===e?this.initParamsList("many"):"2"===e&&this.initParamsList("only"),!0):(this.$message.error("请选择商品分类"),!1)},async initParamsList(e){const{data:t}=await this.$http.get(`categories/${this.cateID}/attributes`,{params:{sel:e}});if(200!==t.meta.status)return this.$message.error("获取商品参数失败");t.data.forEach((e=>{e.attr_vals=e.attr_vals?e.attr_vals.split(","):[]})),"many"===e?this.manyTabletList=t.data:this.onlyTabletList=t.data},handleSuccess(e){const t={pic:e.data.tmp_path};this.addGoodsForm.pics.push(t)},handleRemove(e){const t=e.response.data.tmp_path;this.addGoodsForm.pics=this.addGoodsForm.pics.filter((e=>e.pic!==t))},handlePreview(e){this.previewURL=e.response.data.url,this.previewDialogVisible=!0},addGoods(){this.$refs.addGoodsRef.validate((async e=>{if(!e)return this.$message.error("请填写必要的表单项");const t=JSON.parse(JSON.stringify(this.addGoodsForm));t.goods_cat=t.goods_cat.join(","),this.manyTabletList.forEach((e=>{const t={attr_id:e.attr_id,attr_value:e.attr_vals};this.addGoodsForm.attrs.push(t)})),this.onlyTabletList.forEach((e=>{const t={attr_id:e.attr_id,attr_value:e.attr_vals};this.addGoodsForm.attrs.push(t)})),t.attrs=this.addGoodsForm.attrs;const{data:s}=await this.$http.post("goods",t);if(201!==s.meta.status)return this.$message.error("添加商品失败");this.$message.success("添加商品成功"),this.$router.push("/goods")}))}},computed:{cateID(){return this.addGoodsForm.goods_cat[2]}},created(){this.initCateList()}}),i=r,l=s(1001),d=(0,l.Z)(i,o,a,!1,null,"5ef6bdb0",null),n=d.exports},2927:function(e,t,s){s.r(t),s.d(t,{default:function(){return n}});var o=function(){var e=this,t=e._self._c;return t("div",[t("el-breadcrumb",{attrs:{separator:">"}},[t("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),t("el-breadcrumb-item",[e._v("商品管理")]),t("el-breadcrumb-item",[e._v("商品列表")])],1),t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{placeholder:"请输入搜索内容",clearable:""},on:{clear:e.initGoodsList},model:{value:e.querInfo.query,callback:function(t){e.$set(e.querInfo,"query",t)},expression:"querInfo.query"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.initGoodsList},slot:"append"})],1)],1),t("el-col",{attrs:{span:6}},[t("el-button",{attrs:{type:"primary"},on:{click:e.goAddPage}},[e._v("添加商品")])],1)],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.goodsList,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"index",label:"#",width:"50"}}),t("el-table-column",{attrs:{prop:"goods_name",label:"商品名称",width:"500"}}),t("el-table-column",{attrs:{prop:"goods_price",label:"商品价格(元)",width:"120"}}),t("el-table-column",{attrs:{prop:"goods_weight",label:"商品重量",width:"100"}}),t("el-table-column",{attrs:{label:"创建时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.add_time))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"编辑",placement:"top"}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"small"},on:{click:function(t){return e.showReviseGoodsDialog(s.row.goods_id)}}})],1),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top"}},[t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"small"},on:{click:function(t){return e.deleteGoods(s.row.goods_id)}}})],1)]}}])})],1),t("el-pagination",{attrs:{"current-page":e.querInfo.pagenum,"page-sizes":[5,10,15,20],"page-size":e.querInfo.pagesize,layout:"total, sizes, prev, pager, next, jumper",background:"",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),t("el-dialog",{attrs:{title:"编辑商品",visible:e.reviseGoodsDialogVisible,width:"30%"},on:{"update:visible":function(t){e.reviseGoodsDialogVisible=t},close:e.reviseDialogClosed}},[t("span",[t("el-form",{ref:"reviseGoodsRef",attrs:{model:e.reviseGoodsForm,rules:e.reviseGoodsRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"商品名称",prop:"goods_name"}},[t("el-input",{attrs:{disabled:""},model:{value:e.reviseGoodsForm.goods_name,callback:function(t){e.$set(e.reviseGoodsForm,"goods_name",t)},expression:"reviseGoodsForm.goods_name"}})],1),t("el-form-item",{attrs:{label:"商品价格",prop:"goods_price"}},[t("el-input",{model:{value:e.reviseGoodsForm.goods_price,callback:function(t){e.$set(e.reviseGoodsForm,"goods_price",t)},expression:"reviseGoodsForm.goods_price"}})],1),t("el-form-item",{attrs:{label:"商品重量",prop:"goods_weight"}},[t("el-input",{model:{value:e.reviseGoodsForm.goods_weight,callback:function(t){e.$set(e.reviseGoodsForm,"goods_weight",t)},expression:"reviseGoodsForm.goods_weight"}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.reviseGoodsDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmReviseGoods}},[e._v("确 定")])],1)])],1)],1)},a=[],r=(s(7658),{data(){return{goodsList:[],querInfo:{query:"",pagenum:1,pagesize:10},total:0,reviseGoodsDialogVisible:!1,reviseGoodsForm:{},reviseGoodsRules:{goods_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],goods_price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],goods_weight:[{required:!0,message:"请输入商品重量",trigger:"blur"}]}}},methods:{async initGoodsList(){const{data:e}=await this.$http.get("goods",{params:this.querInfo});if(200!==e.meta.status)return this.$message.error("获取商品信息失败");this.goodsList=e.data.goods,this.total=e.data.total},handleSizeChange(e){this.querInfo.pagesize=e,this.initGoodsList()},handleCurrentChange(e){this.querInfo.pagenum=e,this.initGoodsList()},deleteGoods(e){this.$confirm("此操作将永久删除该商品, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const{data:t}=await this.$http.delete(`goods/${e}`);if(200!==t.meta.status)return this.$message.error("删除商品失败");this.initGoodsList(),this.$message.success("删除商品成功")})).catch((()=>{this.$message.info("已取消删除")}))},async showReviseGoodsDialog(e){this.reviseGoodsDialogVisible=!0;const{data:t}=await this.$http.get(`goods/${e}`);if(200!==t.meta.status)return this.$message.error("获取商品信息失败");this.reviseGoodsForm=t.data},confirmReviseGoods(){this.$refs.reviseGoodsRef.validate((async e=>{if(!e)return this.$message.error("请输入必要的表单项");const{data:t}=await this.$http.put(`goods/${this.reviseGoodsForm.goods_id}`,this.reviseGoodsForm);if(200!==t.meta.status)return this.$message.error("修改商品失败");this.$message.success("修改商品成功"),this.initGoodsList()})),this.reviseGoodsDialogVisible=!1},reviseDialogClosed(){this.$refs.reviseGoodsRef.resetFields()},goAddPage(){this.$router.push("/add")}},created(){this.initGoodsList()}}),i=r,l=s(1001),d=(0,l.Z)(i,o,a,!1,null,null,null),n=d.exports}}]);
//# sourceMappingURL=GoodsList_Add.28bb9024.js.map